<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Christmas Tech Elf Pong</title>
    <style>
        /* Body styling: a subtle cosmic/holiday vibe */
        body {
            margin: 0;
            padding: 0;
            font-family: "Trebuchet MS", sans-serif;
            text-align: center;
            background: radial-gradient(circle at top, #0f2027, #203a43, #2c5364);
            color: #ecf0f1;
        }

        h1 {
            margin-top: 20px;
            color: #f39c12;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6);
        }

        #storyline {
            margin: 0 20px;
            max-width: 800px;
            text-align: left;
            margin: 20px auto;
            border: 2px dashed #f39c12;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        #gameCanvas {
            background: #111;
            display: block;
            margin: 20px auto;
            border: 2px solid #f39c12;
        }

        #levelAnnouncement,
        #info {
            margin-top: 10px;
            font-weight: bold;
            color: #1abc9c;
        }

        #footerMessage {
            margin: 20px;
            color: #f1c40f;
            font-style: italic;
        }

        button {
            background: #1abc9c;
            border: none;
            padding: 10px 15px;
            margin-top: 10px;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #16a085;
        }
    </style>
</head>

<body>
    <h1>Christmas Tech Elf Pong</h1>

    <div id="storyline">
        <p>
            A <strong>rogue robot elf</strong> in Santa’s workshop has gone haywire—he’s locked all the Christmas
            presents in a futuristic storage container. The only way to open it is by entering the <em>correct access
                code</em> into his top-secret database interface.
        </p>
        <p>
            However, this mischievous elf didn’t make it easy. To retrieve the code, you must beat his
            <strong>three-level Pong security system</strong>. Keep your sleigh—well, in this version it's just a
            <em>red paddle</em>—under control, bounce the <em>green ball</em>, and rack up enough hits in each level to
            progress. Every time you pass a level, you’ll receive a piece of the code.
        </p>
        <p>
            Santa is counting on you—can you outsmart the evil robot elf and save Christmas?
        </p>
        <button onclick="startGame()">Begin the Challenge!</button>
    </div>

    <canvas id="gameCanvas" width="600" height="400" style="display:none;"></canvas>
    <div id="levelAnnouncement" style="display:none;"></div>
    <div id="info" style="display:none;"></div>
    <div id="footerMessage" style="display:none;">All is not lost... yet!</div>

    <script>
        /********************************************************
         *                GAME STATE AND SETTINGS               *
         ********************************************************/
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // Paddle (red rectangle) properties
        const paddleWidth = 10;
        let paddleHeight = 80;        // We'll tweak this per level if needed
        let paddleY = (canvas.height - paddleHeight) / 2;
        const paddleX = 30;           // Distance from left edge

        // Ball (green circle) properties
        let ballRadius = 12;          // Circle radius
        let ballX = canvas.width / 2;
        let ballY = canvas.height / 2;
        let ballDX = 4;               // horizontal speed
        let ballDY = 3;               // vertical speed

        // Movement controls
        let upPressed = false;
        let downPressed = false;
        let wPressed = false;
        let sPressed = false;

        // Levels, hints, and scoring
        let currentLevel = 1;
        const totalLevels = 3;
        const levelHints = ["6", "2", "1"];        // Code digits
        const hitsNeededPerLevel = [5, 7, 9];
        let hitsThisLevel = 0;

        // State flags
        let levelComplete = false;
        let gameOver = false;
        let gameStarted = false;

        /********************************************************
         *                EVENT LISTENERS                       *
         ********************************************************/
        document.addEventListener("keydown", keyDownHandler);
        document.addEventListener("keyup", keyUpHandler);

        function keyDownHandler(e) {
            if (e.key === "ArrowUp") {
                upPressed = true;
            } else if (e.key === "ArrowDown") {
                downPressed = true;
            } else if (e.key.toLowerCase() === "w") {
                wPressed = true;
            } else if (e.key.toLowerCase() === "s") {
                sPressed = true;
            }
        }

        function keyUpHandler(e) {
            if (e.key === "ArrowUp") {
                upPressed = false;
            } else if (e.key === "ArrowDown") {
                downPressed = false;
            } else if (e.key.toLowerCase() === "w") {
                wPressed = false;
            } else if (e.key.toLowerCase() === "s") {
                sPressed = false;
            }
        }

        /********************************************************
         *                 LEVEL SETUP                          *
         ********************************************************/
        function setupLevel(level) {
            // Reset ball to center
            ballX = canvas.width / 2;
            ballY = canvas.height / 2;

            // Adjust difficulty
            switch (level) {
                case 1:
                    paddleHeight = 80;
                    ballDX = 4;
                    ballDY = 3;
                    break;
                case 2:
                    paddleHeight = 70;
                    ballDX = 5;
                    ballDY = 4;
                    break;
                case 3:
                    paddleHeight = 60;
                    ballDX = 6;
                    ballDY = 5;
                    break;
                default:
                    endGame();
                    return;
            }

            paddleY = (canvas.height - paddleHeight) / 2;
            hitsThisLevel = 0;
            levelComplete = false;

            document.getElementById("levelAnnouncement").textContent =
                "LEVEL " + level + ": Evil Elf's Security Barrier #" + level;
            document.getElementById("info").textContent =
                "Hits needed to bypass: " + hitsNeededPerLevel[level - 1];
        }

        /********************************************************
         *                MAIN GAME LOOP                        *
         ********************************************************/
        function update() {
            if (!gameStarted || gameOver) return;

            // Move paddle
            if (upPressed || wPressed) {
                paddleY -= 6;
            }
            if (downPressed || sPressed) {
                paddleY += 6;
            }

            // Constrain paddle
            if (paddleY < 0) paddleY = 0;
            if (paddleY + paddleHeight > canvas.height) {
                paddleY = canvas.height - paddleHeight;
            }

            // Move ball
            ballX += ballDX;
            ballY += ballDY;

            // Ball collision with top/bottom
            if (ballY - ballRadius < 0) {
                ballY = ballRadius;
                ballDY = -ballDY;
            }
            else if (ballY + ballRadius > canvas.height) {
                ballY = canvas.height - ballRadius;
                ballDY = -ballDY;
            }

            // Check collision with the paddle
            if (
                // Ball's leftmost edge <= Paddle's right edge
                (ballX - ballRadius) <= (paddleX + paddleWidth) &&
                // Ball's rightmost edge >= Paddle's left edge (this isn't strictly necessary 
                // in a 1-paddle game, but included for completeness)
                (ballX + ballRadius) >= paddleX &&
                // Ball's bottom edge >= top of paddle
                (ballY + ballRadius) >= paddleY &&
                // Ball's top edge <= bottom of paddle
                (ballY - ballRadius) <= (paddleY + paddleHeight)
            ) {
                // Bounce off the paddle
                ballX = paddleX + paddleWidth + ballRadius; // push the ball away from the paddle
                ballDX = -ballDX;
                hitsThisLevel++;
                document.getElementById("info").textContent =
                    "Hits so far: " + hitsThisLevel + " / " + hitsNeededPerLevel[currentLevel - 1];

                // Check if level is beaten
                if (hitsThisLevel >= hitsNeededPerLevel[currentLevel - 1]) {
                    levelComplete = true;
                    levelUp();
                }
            }

            // If ball goes past left edge
            if (ballX + ballRadius < 0) {
                // Reset ball to center
                ballX = canvas.width / 2;
                ballY = canvas.height / 2;
                // Flip direction so it heads right again
                ballDX = -ballDX;
            }

            // If ball hits right boundary
            if (ballX + ballRadius > canvas.width) {
                ballX = canvas.width - ballRadius;
                ballDX = -ballDX;
            }

            draw();
            requestAnimationFrame(update);
        }

        /********************************************************
         *                     DRAWING                          *
         ********************************************************/
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the "red" paddle
            ctx.fillStyle = "#e74c3c";  // bright red
            ctx.fillRect(paddleX, paddleY, paddleWidth, paddleHeight);

            // Draw the "green" ball (circle)
            ctx.beginPath();
            ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = "#27ae60"; // bright green
            ctx.fill();
            ctx.closePath();
        }

        /********************************************************
         *           LEVEL PROGRESSION & ENDING                 *
         ********************************************************/
        function levelUp() {
            if (currentLevel > totalLevels) return;

            alert(
                "Security Barrier #" + currentLevel + " breached!\n" +
                "The Evil Elf grudgingly reveals a code digit: '" + levelHints[currentLevel - 1] + "'"
            );

            currentLevel++;
            if (currentLevel <= totalLevels) {
                setupLevel(currentLevel);
            } else {
                endGame();
            }
        }

        function endGame() {
            gameOver = true;
            document.getElementById("levelAnnouncement").textContent =
                "ALL BARRIERS BYPASSED!";
            document.getElementById("info").innerHTML = `
        <strong>Access Code Retrieved:</strong><br>
        Level 1: '${levelHints[0]}'<br>
        Level 2: '${levelHints[1]}'<br>
        Level 3: '${levelHints[2]}'<br><br>
        <em>Use this code to unlock the presents!</em>
      `;
            document.getElementById("footerMessage").textContent =
                "You’ve outsmarted the evil robot elf! Christmas is saved!";
        }

        /********************************************************
         *               GAME START FUNCTION                    *
         ********************************************************/
        function startGame() {
            // Hide storyline, show canvas & text
            document.getElementById("storyline").style.display = "none";
            canvas.style.display = "block";
            document.getElementById("levelAnnouncement").style.display = "block";
            document.getElementById("info").style.display = "block";
            document.getElementById("footerMessage").style.display = "block";

            gameStarted = true;
            currentLevel = 1;
            setupLevel(currentLevel);
            update();
        }
    </script>
</body>

</html>